
## PICS
모바일 메신저 이용 중의 일정 저장 과정을 간소화하여 사용자들의 불편함을 해소하고자 스크린 캡쳐를 이용하여 일정을 저장하는 기능을 제공한다.

컴퓨터공학종합설계 2020-1
8조 PICS 백엔드/자연어처리 구현 코드

- contributor
  - 백엔드([강지수](https://github.com/kang-jisu))
  - 자연어처리([손인아](https://github.com/Ina-Son))
  - 안드로이드([허예은](https://github.com/yenny-heo)) [PICS](https://github.com/yenny-heo/PICS)

---
# PICS :: Picture for schedule
<img width="181" alt="스크린샷_2022-03-07_오후_7 06 37" src="https://user-images.githubusercontent.com/37580216/158583155-6a481992-a496-4b79-a8e4-5769d591de5f.png">

> **자연어 처리를 이용한 캡쳐 이미지 속 날짜 인식, 자동 입력 캘린더 어플리케이션**
> 

### 프로젝트 요약

- 교내 캡스톤 프로젝트 - 스크린 캡쳐를 이용한 메신저 속 일정 간편 저장 어플 PICS
- 프로젝트 기간 : 2020.03~2020.06
- 사용 기술 : Python3.5, Flask, Aws EC2, selenium
- 역할 : 백엔드 API 개발
    - FLASK를 이용한 서버 개발
    - 날짜에 관한 여러 표현을 오늘 기준 실제 날짜데이터로 변환하는 알고리즘 구현
    - 사람인 맞춤법 검사기를 백그라운드로 크롤링

### 동영상 - 링크

[컴퓨터공학종합설계 8조 PICS 발표영상](https://youtu.be/eFkj4eN2i54)

---

### 프로젝트 개요

카카오톡 등의 모바일 메신저를 통해 약속을 잡는 일이 매우 빈번하다. 이러한 상황에서 일정을 저장하기 위해 사용자들은 메신저 어플리케이션을 종료한 후, 캘린더 어플리케이션을 열어, 날짜 및 시간을 선택하여 저장하는 번거로운 과정을 거친다. 이와 같은 복잡한 과정은 사용자가 일정 저장을 잊거나, 일부 정보를 누락하게 하기도 한다.

**PICS는 모바일 메신저 이용 중의 일정 저장 과정을 간소화하여 사용자들의 불편함을 해소하고자 스크린 캡쳐를 이용하여 일정을 저장하는 기능을 제공한다.**

### 전체 시스템 구성, 기능

<img width="598" alt="스크린샷_2022-03-07_오후_7 07 45" src="https://user-images.githubusercontent.com/37580216/158583178-3d96e1c0-768d-4652-8f6f-85eddde1086f.png">


1. 사용자가 캡처한 대화를 어플에 공유한다.
2. 안드로이드 어플에서 서버로 공유받은 이미지 파일을 전송한다.
3. 서버는 캡처 이미지 속에서 필요한 데이터를 추출하여 어플로 보내준다.
4. 구글 캘린더에 일정을 저장한다.
5. 구글 캘린더에 저장된 일정을 불러온다.
6. 사용자에게 표시된다.

### 프로젝트 동작 구조
<img width="889" alt="스크린샷_2022-03-07_오후_7 09 01" src="https://user-images.githubusercontent.com/37580216/158583195-88f3b58a-3e74-42d9-8221-ce16d2104310.png">


### 프로젝트 상세 화면
<img width="430" alt="스크린샷_2022-03-07_오후_7 21 00" src="https://user-images.githubusercontent.com/37580216/158583220-4bf07856-5df1-4c7a-983c-ecce34c72001.png">
<img width="430" alt="스크린샷_2022-03-07_오후_7 21 15" src="https://user-images.githubusercontent.com/37580216/158583409-a5d86ed7-0e25-4e2a-bda9-64cdb1ce7463.png">


## 백엔드 구현 기능

### 구조
<img width="290" alt="스크린샷_2022-03-07_오후_7 11 26" src="https://user-images.githubusercontent.com/37580216/158583236-4ac8aa7e-4e81-4bea-8c6e-1aaf9e78c3c4.png">

- 통신을 위해 EC2서버에 flask rest api서버를 백그라운드로 구동시킨다.
- 요청을 받으면 파일을 임시로 저장한다.
- 말풍선을 인식해 OCR을 통해 대화 문장을 가져온다.
- 가져온 문장을 하나로 합쳐 맞춤법 검사를 위해 크롤링한다.
- 검사된 문장을 가져와 적절한 날짜를 선택하는 코드를 수행한다.
- 모든 날짜 선택이 완료된 [날짜,시간]형식의 데이터로부터 실제 숫자로된 날짜 형식으로 추출한다.
- 받아온 데이터를 반환 형식(시작날짜,시간-종료날짜,시간)에 맞추어 요청을 보낸 프론트 서버에 돌려준다.

### 웹 서버 구축

- 서버 배포
    - 프론트엔드와 통신하기 위한 서버 구축을 위해 아마존 웹 서비스(AWS)의 EC2를 이용한다.
- Flask API
    - REST API 서버는 python 웹 어플리케이션 프레임워크인 FLASK를 사용한다. OCR(이미지 속 텍스트 추출) 및 NLP(자연어 처리) 기능을 python 언어로 사용하므로 python 코드를 내장하여 실행시킬 수 있고 다른 프레임워크(ex: Django)보다 심플하고 가볍다는 장점이 있어 채택하였다
- 백그라운드 실행
    - 서버가 백그라운드에서 계속 실행되게 하기 위해 nohup & 을 사용한다.
- API
    -   <img width="430" alt="스크린샷_2022-03-07_오후_7 14 37" src="https://user-images.githubusercontent.com/37580216/158583476-c46bf7f7-0bfb-4f88-ad08-b83e0964c83e.png">


### 주요 기술

- **크롤링**
    - 사용 라이브러리 : selenium
    - Google chrome 백그라운드 실행
- **CORS**
    - CORS란 교차 출처 리소스 공유(Cross-origin resource sharing)로, 웹페이지 상의 제한된 리소스를 최초 자원이 서비스된 도메인 밖의 다른 도메인으로부터 요청할 수 있게 허용하는 구조이다. 파이썬의 CORS설정을 위해 flask_cors를 사용해 cross_origin을 *(all)로 설정해주었다.
- **Flask에서 Keras 모델 deploy하기**
    - Flask는 요청이 들어올 때 마다 새로운 쓰레드를 생성하기 때문에 미리 불러온 모델을 요청이 들어올 때 인식하지 못하는 오류를 해결하기 위해  해당하는 기본 graph와 session global로 설정해주어 요청시마다 graph.as_default() 내에서 실행되도록 하였다.
- **swapfile**
    - 무료로 사용할 수 있는 ec2 프리티어는 제공되는 메모리가 1GB로 제한적이어서, swapfile을 사용해 사용가능한  메모리 공간을 늘렸다.
- **날짜 추출**
    - 추출 규칙대화 내에 날짜와 시간이 모두 명시되어 있을 경우 둘 다 추출하고, 날짜만 명시되어 있을 경우 날짜에 0시 0분 , 시간만 명시되어 있을 경우 적절하게 오전,오후를 나누었다.  
       ![스크린샷 2022-03-16 오후 8 49 34](https://user-images.githubusercontent.com/37580216/158583724-7d8a281c-485f-4d48-aca4-127c9a59671c.png)
    
    - 명시된 표현이 없다면 오늘 현재의 시간을 기준으로 하며, 한 주의 시작은 월요일로 한다.
    - 또한 특정 일을 지칭하는 것이 아닌, 다음주, 내일 과 같은 미래를 나타내는 단어일 경우 달이나 년을 넘어가는 처리를 해주었다.
        <img width="500" alt="스크린샷_2022-03-07_오후_7 19 58" src="https://user-images.githubusercontent.com/37580216/158583262-76f14ec1-9f25-4ea6-94a9-fcce5504e85c.png">
        
